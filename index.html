import React, { useState, useEffect } from 'react';
import { Sparkles, History, BookOpen, Copy, Heart, Trash2, RefreshCw, Share2 } from 'lucide-react';

// REFERENCE EXAMPLES - pouze pro uk√°zku stylu, NE pro pou≈æit√≠!
const REFERENCE_EXAMPLES = `Voblb Br√°ta, Hei Pozdejc, Pik Nakuli, Krom Ho≈ôej≈°ka, Span Embohem, Jen Hr√°bl, S√°mo Hrabƒõsp√°d, Maglajz Infotent, D≈æejms Box, Jota Sojag, Puƒçmeloud, Blic√≠ Tr≈Øn, Kalivoda, Prasklej P√≠st, Hastro≈° Hadrovej, Pivn√≠ Pupek, Franta Jetel, Cyril Kahan, Metodƒõj Knot, Ludva Lampa, Olda Ohe≈à, Bed≈ôich Blesk, Rostislav Rychlej, Stanislav Starej, Drmol Kotƒõhrb, Angus V√°bil, ≈†mrnc Potƒõp, P≈ôesed Vokvƒõt, Tal√°r Tol√°rek, Bo≈æimela Ml√Ωnkov√°, Drhnodƒõj Nevimƒçap, Dr≈ækama Byl√°dil, ƒåernibyl Duk√°tzbyl, Envi Roment√°l, Indivyndal Lulista, Gero Dvadnynavyrys, Jarameny Krƒçiti, Hovnovej≈° Muklakl√°til, Pokaƒè Pokaklsiga≈•, Zad≈ôist Napa≈°k√°l, ƒåembr ≈Ωumpa, Vep≈ô ≈Ωralbykedluben, Cicko Prsnapatƒõ, Varmu≈æa Chcezamu≈æa, Sezam Kl√°til, Calbit Javol, Ba≈æl√°m ≈†i≈°la, Es Koum, Fidel Hrnec, Flink Zapla≈•to, Vy≈°mejd Fla≈°tiƒçka, ≈†mik Prsnapatƒõ, Gusta Di≈°put, Lotr dam √öƒáest, Nakram Narval, Tam-tam z Tramt√°rie, ≈†pul√≠n Bukviƒçka, ƒåvachtal Nedoƒçuch, Naƒçapal Piƒçuvicekrat, V√≠cekr√°t Nalamal, Filemon Dochvilka, K√°psi Napsy, D≈æembychtƒõl ƒåajdostal, Namistrach K≈ôeƒçkopich, Mistroskol Fouklpad, ≈†vih Ahak, Mondovoda Nestihst≈ôik, Cvrnksi Podlah√°≈ô, Stono≈æ Ptaƒçkoviƒçnik, Zupa Pakupa, Supykl√°t Hn√≠zdo, ≈Ωvejk Pt√°ƒçekpryƒç, ≈Ωermƒõsfutrama Palimevi≈°nƒõ, Mandar√Ωn Elmo≈æno, N√°met Fuƒç√≠k, Hnidoslav Nepich, Zas Ujel, Zhas Knot, Bot ≈†mudl√≠nek, Krop Zlokot, Kvoƒç ≈Ωampouch, Naƒçrtjamku P≈ôizdispal, Valbalamut Lep≈°ikozacela, Kdy≈ætovp≈Øl Folautne≈°, Najarval Vazmo≈æno, Narvat Gule, ƒåepej≈ô Vatiƒçka, Mlƒç Zapuch, Bohumil Slu≈æba, Bl√°to≈°lap Pono≈æka, Blbƒõ≈°lap Bl√°tor√°d, Sislin Ku≈æelka, P≈ô√≠lep Namoutƒõ, Dochviln√° Doklepka, Z√°clonsp√°d Kostiƒçkopono≈æka, Nakaktusu Kulekr√°l, Vy≈æd√≠m Nato, Vobr Cosi, Vnik Vod≈Ømcodal, Bl√°tem Piƒçumyl, Jak≈æblebt Takpl√°c, U≈ægar Naomak, Usmah Nedalto, Zaku≈ôs√°m Zb√≠rejto, Maldinko Plandal, NafusyVzor Palmanapiƒçu, Palma Napiƒç, Kev≈°emu ≈†el, ≈Ωumpel√≠k Sr√°ƒçkovstv√≠, ≈Ωeltom√°m Zasebou, Lakabele ≈Ωeli≈æe, Lekabele Znozdryp√≠≈°e, Lechkabele Nechle≈æet, Selizat Nechkabele, Samzarakos ≈†else≈ær√°t, V√≠cedylin ≈òekstopiƒço, V√≠cev√Ωprask Nap≈ôesrok, Umakart Naomak, Vy≈æd√≠m Nevƒõ≈ôil, N√°fuk Jakbalon, Z√°cpa Plyn√°rny, Fuksmrad Prskzvuk, Podvous Z√°tahkaramel, Man√Ωr Plnyrypak, ≈Ωral Vejcevslupce, Kulerval Sobƒõdal, Hejblhned Vr√°tilkostka, Boco Komand, ≈†aktyn Takydyk, Nenech Avejdary, ≈†ploun V√Ωƒçmuch, Z√≠vl Ne≈ô√°d, Lekn√≠n Stalin, Kostƒõj Nostra, Damus Kolumbus, Busu≈æ Nechtƒõl, Ro≈°tich Chichokl√°tiv√Ω, Ur Mund, Cot Ojepiƒço, Noheh Ehechecht, Naspal Slonahlavƒõ, Doj Ebcipe, Kolik Hehotdaj, Pr√°sk Kolika, Vokol Kolemd≈Øldal, Kucht Zava≈ôil`;

const REFERENCE_NAMES = REFERENCE_EXAMPLES.split(', ').map(name => ({
  name: name,
  context: "referenƒçn√≠ vzor stylu"
}));

export default function NameGenerator() {
  const [input, setInput] = useState('');
  const [generated, setGenerated] = useState([]);
  const [history, setHistory] = useState([]);
  const [favorites, setFavorites] = useState([]);
  const [customReferences, setCustomReferences] = useState([]);
  const [loading, setLoading] = useState(false);
  const [showHistory, setShowHistory] = useState(false);
  const [showReferences, setShowReferences] = useState(false);
  const [showImport, setShowImport] = useState(false);
  const [importText, setImportText] = useState('');
  const [error, setError] = useState('');

  // Load data from storage
  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    try {
      const historyData = await window.storage.get('name-history');
      const favData = await window.storage.get('name-favorites');
      const refsData = await window.storage.get('custom-references');
      
      if (historyData) setHistory(JSON.parse(historyData.value));
      if (favData) setFavorites(JSON.parse(favData.value));
      if (refsData) setCustomReferences(JSON.parse(refsData.value));
    } catch (e) {
      console.log('No stored data yet');
    }
  };

  const capitalizeName = (name) => {
    return name.split(' ').map(word => 
      word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
    ).join(' ');
  };

  const saveToStorage = async (key, data) => {
    try {
      await window.storage.set(key, JSON.stringify(data));
    } catch (e) {
      console.error('Storage error:', e);
    }
  };

  const validateCzechDiacritics = (text) => {
    const czechRegex = /^[A-Za-z√°ƒçƒè√©ƒõ√≠≈à√≥≈ô≈°≈•√∫≈Ø√Ω≈æ√Åƒåƒé√âƒö√ç≈á√ì≈ò≈†≈§√ö≈Æ√ù≈Ω\s-]+$/;
    return czechRegex.test(text);
  };

  const generateNames = async () => {
    if (!input.trim()) {
      setError('Zadej slovo pro generov√°n√≠');
      return;
    }

    setLoading(true);
    setError('');
    setGenerated([]);

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          messages: [{
            role: 'user',
            content: `Jsi kreativn√≠ gener√°tor NOV√ùCH ƒçesk√Ωch jmen. Tv√Ωm √∫kolem je vymyslet 5 ZCELA NOV√ùCH jmen inspirovan√Ωch slovem: "${input}"

üî¥ KRITICK√Å PRAVIDLA:
1. VYMYSLI NOV√Å JM√âNA - NIKDY nepou≈æ√≠vej existuj√≠c√≠ referenƒçn√≠ vzory doslova
2. Pou≈æ√≠vej POUZE spr√°vnou ƒçeskou diakritiku: √°, ƒç, ƒè, √©, ƒõ, √≠, ≈à, √≥, ≈ô, ≈°, ≈•, √∫, ≈Ø, √Ω, ≈æ
3. NIKDY nepou≈æ√≠vej: z m√≠sto ≈æ, c m√≠sto ƒç, r m√≠sto ≈ô, u m√≠sto ≈Ø/√∫
4. Ka≈æd√© jm√©no = Jm√©no + P≈ô√≠jmen√≠ (nap≈ô. "Bed≈ôich Blesk", "Ludva Lampa")
5. Ka≈æd√© jm√©no mus√≠ m√≠t vtipn√Ω/filozofick√Ω kontext (max 10 slov)

‚ö†Ô∏è SPECI√ÅLN√ç PO≈ΩADAVKY NA JM√âNA 4 A 5:
- Jm√©no #4: MUS√ç zaƒç√≠nat P≈òESNƒö slovem "${input}" jako k≈ôestn√≠ jm√©no (nap≈ô. "${input} Z√°zraƒçn√Ω")
- Jm√©no #5: MUS√ç konƒçit P≈òESNƒö slovem "${input}" jako p≈ô√≠jmen√≠ (nap≈ô. "Svatopluk ${input}")

üé® KREATIVN√ç TECHNIKY (pro jm√©na 1-3):
- S√©mantick√© asociace: "${input}" ‚Üí jak√© evokuje pojmy?
- Morfologick√° hra: Prefixace (Ne-, Pro-, Roz-), Sufixace (-iƒç, -√°k, -ej)
- Absurdn√≠ kombinace: Spojuj nesourod√© pojmy pro humor
- Filozofick√Ω p≈ôesah: Odkazy na v√≠ru, existenci, ƒças

üìö REFERENƒåN√ç VZORY STYLU (NEPOU≈Ω√çVEJ JE, jen se INSPIRUJ):
${REFERENCE_NAMES.slice(0, 15).map(r => r.name).join(', ')}...

ODPOVƒöZ POUZE V TOMTO JSON FORM√ÅTU:
{
  "names": [
    {"name": "Kreativn√≠ Jm√©no", "context": "vtipn√Ω kontext"},
    {"name": "Dal≈°√≠ Kreativn√≠", "context": "filozofick√Ω kontext"},
    {"name": "T≈ôet√≠ Origin√°ln√≠", "context": "absurdn√≠ kontext"},
    {"name": "${input} Vygenerovan√©P≈ô√≠jmen√≠", "context": "kontext pro tuto variantu"},
    {"name": "Vygenerovan√©Jm√©no ${input}", "context": "kontext pro tuto variantu"}
  ]
}

≈Ω√°dn√Ω dal≈°√≠ text, POUZE JSON. VYGENERUJ 5 JMEN!`
          }]
        })
      });

      const data = await response.json();
      
      if (data.content && data.content[0]) {
        let textContent = data.content[0].text;
        
        // Clean JSON from markdown
        textContent = textContent.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
        
        const parsed = JSON.parse(textContent);
        
        if (parsed.names && Array.isArray(parsed.names)) {
          // Validate Czech diacritics and capitalize
          const validatedNames = parsed.names.map(n => ({
            ...n,
            name: capitalizeName(n.name), // Kapitalizace
            valid: validateCzechDiacritics(n.name)
          }));

          setGenerated(validatedNames);
          
          // Add to history
          const newHistory = [{
            input: input,
            names: validatedNames,
            timestamp: new Date().toISOString()
          }, ...history].slice(0, 50);
          
          setHistory(newHistory);
          saveToStorage('name-history', newHistory);
        }
      }
    } catch (err) {
      console.error('Generation error:', err);
      setError('Chyba p≈ôi generov√°n√≠. Zkus to znovu.');
    } finally {
      setLoading(false);
    }
  };

  const addToFavorites = (name) => {
    if (!favorites.find(f => f.name === name.name)) {
      const newFavorites = [...favorites, { ...name, addedAt: new Date().toISOString() }];
      setFavorites(newFavorites);
      saveToStorage('name-favorites', newFavorites);
    }
  };

  const addToReferences = async (name) => {
    try {
      let customRefs = [...customReferences]; // Pou≈æ√≠t aktu√°ln√≠ state
      
      if (!customRefs.find(r => r.name === name.name)) {
        const newRef = { ...name, addedAt: new Date().toISOString() };
        customRefs.push(newRef);
        
        // Ulo≈æit do storage
        await window.storage.set('custom-references', JSON.stringify(customRefs));
        
        // Aktualizovat state
        setCustomReferences(customRefs);
        
        alert(`‚úÖ "${name.name}" p≈ôid√°no do referenc√≠!`);
      } else {
        alert(`‚ÑπÔ∏è "${name.name}" u≈æ je v referenc√≠ch.`);
      }
    } catch (e) {
      console.error('Reference add error:', e);
      alert('‚ùå Chyba p≈ôi p≈ôid√°v√°n√≠ do referenc√≠');
    }
  };

  const removeFromFavorites = (name) => {
    const newFavorites = favorites.filter(f => f.name !== name.name);
    setFavorites(newFavorites);
    saveToStorage('name-favorites', newFavorites);
  };

  const removeFromReferences = async (name) => {
    const newCustomRefs = customReferences.filter(r => r.name !== name.name);
    setCustomReferences(newCustomRefs);
    await window.storage.set('custom-references', JSON.stringify(newCustomRefs));
  };

  const importNames = async () => {
    if (!importText.trim()) {
      alert('‚ùå Vlo≈æte jm√©na do textov√©ho pole!');
      return;
    }

    // Parse jmen - ka≈æd√Ω ≈ô√°dek = jedno jm√©no
    const lines = importText.split('\n').map(line => line.trim()).filter(line => line);
    
    let imported = 0;
    let skipped = 0;
    
    for (const line of lines) {
      // Kapitalizace
      const capitalizedName = capitalizeName(line);
      
      // Kontrola, jestli u≈æ nen√≠ v customReferences
      if (customReferences.find(r => r.name === capitalizedName)) {
        skipped++;
        continue;
      }
      
      // P≈ôidat
      const newRef = {
        name: capitalizedName,
        context: "importov√°no ze schr√°nky",
        addedAt: new Date().toISOString()
      };
      
      customReferences.push(newRef);
      imported++;
    }
    
    // Ulo≈æit
    setCustomReferences([...customReferences]);
    await window.storage.set('custom-references', JSON.stringify(customReferences));
    
    // Reset
    setImportText('');
    setShowImport(false);
    
    alert(`‚úÖ Importov√°no: ${imported} jmen\n‚è≠Ô∏è P≈ôeskoƒçeno (duplicity): ${skipped}`);
  };

  const copyToClipboard = (text) => {
    // Fallback metoda pro kop√≠rov√°n√≠
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    document.body.appendChild(textArea);
    textArea.select();
    
    try {
      document.execCommand('copy');
      console.log('Text copied:', text);
    } catch (err) {
      console.error('Copy failed:', err);
    }
    
    document.body.removeChild(textArea);
  };

  const shareList = (items) => {
    const text = items.map(item => item.name).join('\n');
    
    // Fallback metoda
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    document.body.appendChild(textArea);
    textArea.select();
    
    try {
      const successful = document.execCommand('copy');
      if (successful) {
        alert(`‚úÖ ${items.length} jmen zkop√≠rov√°no do schr√°nky!`);
      } else {
        alert('‚ùå Chyba p≈ôi kop√≠rov√°n√≠');
      }
    } catch (err) {
      console.error('Share failed:', err);
      alert('‚ùå Chyba p≈ôi kop√≠rov√°n√≠');
    }
    
    document.body.removeChild(textArea);
  };

  const clearHistory = () => {
    setHistory([]);
    saveToStorage('name-history', []);
  };

  return (
    <div className="min-h-screen bg-black text-white p-3">
      <div className="max-w-5xl mx-auto">
        {/* Header */}
        <div className="text-center mb-4 pt-3">
          <div className="flex items-center justify-center gap-2 mb-2">
            <Sparkles className="w-7 h-7 text-yellow-400" />
            <h1 className="text-2xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
              Gener√°tor Kontextov√Ωch Jmen
            </h1>
          </div>
          <p className="text-gray-400 text-xs">
            Lingvista a kulturn√≠ antropolog specializuj√≠c√≠ se na humor, slovn√≠ h≈ô√≠ƒçky a filozofick√© p≈ôesahy
          </p>
        </div>

        {/* Input Section */}
        <div className="bg-gray-900 rounded-xl p-3 mb-3 border border-gray-800">
          <div className="flex gap-2">
            <input
              type="text"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && generateNames()}
              placeholder="Zadej slovo (nap≈ô. duk√°tzbyl, span√≠, svƒõtlo...)"
              className="flex-1 bg-gray-950 border border-gray-700 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-yellow-500 transition-colors"
            />
            <button
              onClick={generateNames}
              disabled={loading}
              className="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 disabled:from-gray-600 disabled:to-gray-600 px-5 py-2 rounded-lg font-bold text-sm transition-all flex items-center gap-2"
            >
              {loading ? (
                <>
                  <RefreshCw className="w-4 h-4 animate-spin" />
                  Generuji...
                </>
              ) : (
                <>
                  <Sparkles className="w-4 h-4" />
                  Generovat
                </>
              )}
            </button>
          </div>
          {error && (
            <p className="text-red-400 mt-2 text-xs">{error}</p>
          )}
        </div>

        {/* Action Buttons */}
        <div className="flex gap-2 mb-3">
          <button
            onClick={() => setShowHistory(!showHistory)}
            className="flex-1 bg-gray-900 hover:bg-gray-800 border border-gray-800 rounded-lg px-3 py-2 flex items-center justify-center gap-2 transition-all text-sm"
          >
            <History className="w-4 h-4" />
            Historie ({history.length})
          </button>
          <button
            onClick={() => setShowReferences(!showReferences)}
            className="flex-1 bg-gray-900 hover:bg-gray-800 border border-gray-800 rounded-lg px-3 py-2 flex items-center justify-center gap-2 transition-all text-sm"
          >
            <BookOpen className="w-4 h-4" />
            Referenƒçn√≠ vzory ({REFERENCE_NAMES.length + customReferences.length})
          </button>
          <button
            onClick={() => setShowImport(!showImport)}
            className="flex-1 bg-blue-900 hover:bg-blue-800 border border-blue-800 rounded-lg px-3 py-2 flex items-center justify-center gap-2 transition-all text-sm"
          >
            <BookOpen className="w-4 h-4" />
            Import jmen
          </button>
        </div>

        {/* Import Modal */}
        {showImport && (
          <div className="bg-gray-900 rounded-xl p-4 mb-3 border border-blue-500/30">
            <h2 className="text-lg font-bold mb-3 flex items-center gap-2">
              <BookOpen className="w-5 h-5 text-blue-400" />
              Hromadn√Ω import jmen
            </h2>
            <p className="text-xs text-gray-400 mb-3">
              Vlo≈æte jm√©na ze schr√°nky - ka≈æd√© jm√©no na nov√Ω ≈ô√°dek. Form√°t: "Jm√©no P≈ô√≠jmen√≠"
            </p>
            <textarea
              value={importText}
              onChange={(e) => setImportText(e.target.value)}
              placeholder="Houbel Vaj√≠ƒçko
Nav√≠no Machr
Ba≈•oh√°ƒçek Napi≈°tuvstal
Dermakol Nepƒõtkol"
              className="w-full bg-gray-950 border border-gray-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-blue-500 transition-colors h-32 resize-none"
            />
            <div className="flex gap-2 mt-3">
              <button
                onClick={importNames}
                className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold text-sm transition-all"
              >
                ‚úì Importovat ({importText.split('\n').filter(l => l.trim()).length} jmen)
              </button>
              <button
                onClick={() => {
                  setShowImport(false);
                  setImportText('');
                }}
                className="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition-all"
              >
                Zru≈°it
              </button>
            </div>
          </div>
        )}

        {/* Generated Names */}
        {generated.length > 0 && (
          <div className="bg-gray-900 rounded-xl p-3 mb-3 border border-yellow-500/30">
            <h2 className="text-lg font-bold mb-2 flex items-center gap-2">
              <Sparkles className="w-5 h-5 text-yellow-400" />
              Vygenerovan√° jm√©na
            </h2>
            <div className="space-y-2">
              {generated.map((item, idx) => (
                <div
                  key={idx}
                  className={`bg-gray-950 rounded-lg p-2 border ${
                    item.valid ? 'border-green-500/30' : 'border-red-500/50'
                  } ${idx >= 3 ? 'border-l-4 border-l-blue-500' : ''}`}
                >
                  <div className="flex items-start justify-between gap-3">
                    <div className="flex-1 min-w-0">
                      <h3 className="text-base font-bold text-yellow-400 mb-0.5 truncate">
                        {item.name}
                        {!item.valid && (
                          <span className="ml-2 text-xs text-red-400 font-normal">
                            ‚ö†Ô∏è Chybn√° diakritika
                          </span>
                        )}
                      </h3>
                      <p className="text-gray-400 italic text-xs line-clamp-2">{item.context}</p>
                    </div>
                    <div className="flex gap-1 flex-shrink-0">
                      <button
                        onClick={() => copyToClipboard(item.name)}
                        className="p-1.5 bg-gray-800 hover:bg-gray-700 rounded transition-all"
                        title="Kop√≠rovat"
                      >
                        <Copy className="w-3.5 h-3.5" />
                      </button>
                      <button
                        onClick={() => addToReferences(item)}
                        className="p-1.5 bg-blue-900/50 hover:bg-blue-800/50 rounded transition-all"
                        title="P≈ôidat do referenc√≠"
                      >
                        <BookOpen className="w-3.5 h-3.5" />
                      </button>
                      <button
                        onClick={() => addToFavorites(item)}
                        className={`p-1.5 rounded transition-all ${
                          favorites.find(f => f.name === item.name)
                            ? 'bg-red-500/50 hover:bg-red-500/70'
                            : 'bg-gray-800 hover:bg-gray-700'
                        }`}
                        title="P≈ôidat do obl√≠ben√Ωch"
                      >
                        <Heart className="w-3.5 h-3.5" />
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Favorites */}
        {favorites.length > 0 && (
          <div className="bg-gray-900 rounded-xl p-3 mb-3 border border-gray-800">
            <div className="flex items-center justify-between mb-2">
              <h2 className="text-base font-bold flex items-center gap-2">
                <Heart className="w-4 h-4 text-red-400" />
                Obl√≠ben√° jm√©na ({favorites.length})
              </h2>
              <button
                onClick={() => shareList(favorites)}
                className="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1"
              >
                <Share2 className="w-3 h-3" />
                Kop√≠rovat do schr√°nky
              </button>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
              {favorites.map((item, idx) => (
                <div key={idx} className="bg-gray-950 rounded-lg p-2 flex items-center justify-between">
                  <div className="min-w-0 flex-1">
                    <p className="font-bold text-yellow-400 text-sm truncate">{item.name}</p>
                    <p className="text-xs text-gray-500 italic truncate">{item.context}</p>
                  </div>
                  <button
                    onClick={() => removeFromFavorites(item)}
                    className="p-1.5 bg-red-500/20 hover:bg-red-500/40 rounded transition-all flex-shrink-0 ml-2"
                  >
                    <Trash2 className="w-3.5 h-3.5" />
                  </button>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* History */}
        {showHistory && (
          <div className="bg-gray-900 rounded-xl p-3 mb-3 border border-gray-800">
            <div className="flex items-center justify-between mb-2">
              <h2 className="text-base font-bold flex items-center gap-2">
                <History className="w-4 h-4" />
                Historie generov√°n√≠
              </h2>
              {history.length > 0 && (
                <button
                  onClick={clearHistory}
                  className="text-xs text-red-400 hover:text-red-300 flex items-center gap-1"
                >
                  <Trash2 className="w-3 h-3" />
                  Smazat v≈°e
                </button>
              )}
            </div>
            <div className="space-y-2 max-h-60 overflow-y-auto">
              {history.map((item, idx) => (
                <div key={idx} className="bg-gray-950 rounded-lg p-2">
                  <p className="text-xs text-gray-500 mb-1">
                    Input: <span className="text-yellow-400 font-bold">{item.input}</span>
                  </p>
                  <div className="space-y-0.5">
                    {item.names.map((n, nIdx) => (
                      <p key={nIdx} className="text-xs text-gray-400 truncate">
                        ‚Ä¢ {n.name} <span className="text-gray-600 italic">({n.context})</span>
                      </p>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* References */}
        {showReferences && (
          <div className="bg-gray-900 rounded-xl p-3 border border-gray-800">
            <div className="flex items-center justify-between mb-2">
              <h2 className="text-base font-bold flex items-center gap-2">
                <BookOpen className="w-4 h-4" />
                Referenƒçn√≠ vzory
              </h2>
              <button
                onClick={() => shareList(REFERENCE_NAMES.concat(customReferences))}
                className="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1"
              >
                <Share2 className="w-3 h-3" />
                Kop√≠rovat do schr√°nky
              </button>
            </div>
            
            {/* Vestavƒõn√© reference (nelze mazat) */}
            {REFERENCE_NAMES.length > 0 && (
              <>
                <p className="text-xs text-gray-500 mb-2">Vestavƒõn√© ({REFERENCE_NAMES.length}):</p>
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-3 max-h-40 overflow-y-auto">
                  {REFERENCE_NAMES.map((item, idx) => (
                    <div key={idx} className="bg-gray-950 rounded-lg p-2">
                      <p className="font-bold text-yellow-400 text-xs truncate">{item.name}</p>
                    </div>
                  ))}
                </div>
              </>
            )}
            
            {/* Vlastn√≠ reference (s mo≈ænost√≠ mazat) */}
            {customReferences.length > 0 && (
              <>
                <p className="text-xs text-gray-500 mb-2">Vlastn√≠ ({customReferences.length}):</p>
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-40 overflow-y-auto">
                  {customReferences.map((item, idx) => (
                    <div key={idx} className="bg-gray-950 rounded-lg p-2 flex items-center justify-between gap-2">
                      <p className="font-bold text-green-400 text-xs truncate flex-1">{item.name}</p>
                      <button
                        onClick={() => removeFromReferences(item)}
                        className="p-1 bg-red-500/20 hover:bg-red-500/40 rounded transition-all flex-shrink-0"
                        title="Odstranit"
                      >
                        <Trash2 className="w-3 h-3 text-red-400" />
                      </button>
                    </div>
                  ))}
                </div>
              </>
            )}
          </div>
        )}

        {/* Footer */}
        <div className="text-center text-gray-700 text-xs mt-3 pb-2">
          <p>Powered by Claude Sonnet 4 ‚Ä¢ Validace ƒçesk√© diakritiky aktivn√≠</p>
        </div>
      </div>
    </div>
  );
}
